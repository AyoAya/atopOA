<!-- 【模板继承】 -->
<extend name="layout/default"/>
<!-- 【引入css样式表文件】 -->
<block name="linkcss">
    <link rel="stylesheet" href="__CSS__/bs-is-fun.css">
	<link rel="stylesheet" href="__PUBLIC__/layui/css/layui.css">
    <link rel="stylesheet" href="__CSS__/sample/overview.css">
	<link rel="stylesheet" href="__CSS__/sample/detail.css">
	<link rel="stylesheet" href="__CSS__/procedure.css">
</block>
<!-- 【引入javascript文件】 -->
<block name="linkjs">
	<script src="__PUBLIC__/layui/layui.js"></script>
	<script src="__JS__/sample/detail.js"></script>
</block>
<!-- 【页面标题】 -->
<block name="webtitle">
	<title>添加样品</title>
</block>
<!-- 【路径导航】 -->
<block name="breadcrumb">
	<ol class="breadcrumb breadcrumb-edit">
		<li><a href="__ROOT__/Sample">样品管理</a></li>
		<li><a href="__ROOT__/Sample/overview/id/{$detailResult.detail_assoc}">订单总览</a></li>
		<li class="active">订单详情</li>
	</ol>
</block>

<block name="content">
	
	<div class="row">
		<div class="col-lg-12 sample-table-container">
			<table class="layui-table" lay-skin="line">
				<thead>
					<tr>
						<th>进度</th>
						<th>样品单号</th>
						<th>产品类型</th>
						<th>产品型号</th>
						<th>产品经理</th>
						<th>模块数量</th>
						<th>客户名称</th>
						<th>设备品牌</th>
						<th>设备型号</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td></td>
						<td>{$detailResult.order_num}</td>
						<td>{$detailResult.type}</td>
						<td>{$detailResult.pn}</td>
						<td>{$detailResult.nickname}</td>
						<td>{$detailResult.count}</td>
						<td>{$detailResult.customer}</td>
						<td>{$detailResult.brand}</td>
						<td>{$detailResult.model}</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>




	<div class="procedure">
		<table class="procedure-table">
			<tr class="procedure-wrap">
				<!--<td class="active">
					<div class="procedure-title">下单
						<i class=" icon-info-sign myTooltip" data-container="body" data-toggle="popover" data-placement="right"
						   data-content="顶部的 Popover 中的一些内容">
						</i>
					</div>
					<div class="procedure-step"><i class="icon-ok"></i></div>
					<div class="procedure-info">2017-04-06 14:56</div>
					<div class="procedure-hollow"></div>
				</td>
-->
				<volist name="step" id="value" key="kk">

					<volist name="detailResult.operating" id="vo" key="k">
						<eq name="value.id" value="$vo.id">
							{//已完成步骤}
							<notempty name="vo.op_time">
								<td class="active">
									<div class="procedure-title">{$value.name}</div>
									<div class="procedure-step"><i class="icon-ok"></i></div>
									<div class="procedure-info">
										<volist name="detailResult.operating" id="val">
											<eq name="value.id" value="$val.id">
												{$val.op_time|date="Y-m-d H:i",###}
											</eq>
										</volist>
									</div>
									<div class="procedure-hollow"></div>
								</td>
							<else/>
								{//进行中的步骤}
								<td>
									<div class="procedure-title">{$value.name}</div>
									<div class="procedure-step">{$kk}</div>
									<div class="procedure-info">
										<volist name="detailResult.operating" id="val">
											<eq name="value.id" value="$val.id">
												{$val.op_time|date="Y-m-d H:i",###}
											</eq>
										</volist>
									</div>
									<div class="procedure-hollow"></div>
								</td>
							</notempty>
						</eq>
					</volist>
					<if condition="($value['id']-1) egt count($detailResult['operating'])">
						{//还未进行的步骤}
						<td>
							<div class="procedure-title">{$value.name}</div>
							<div class="procedure-step">{$kk}</div>
							<div class="procedure-info">
								<volist name="detailResult.operating" id="val">
									<eq name="value.id" value="$val.id">
										{$val.op_time|date="Y-m-d H:i",###}
									</eq>
								</volist>
							</div>
							<div class="procedure-hollow"></div>
						</td>
					</if>
				</volist>

			</tr>
		</table>
	</div>

	<div class="row">
		<div class="col-lg-6 sample-main-left">
			<div class="layui-collapse">
				<div class="layui-colla-item">
					<h2 class="layui-colla-title">交期</h2>
					<div class="layui-colla-content layui-show">
						<span>要求交期：{$detailResult.requirements_date}</span>
						<notempty name="detailResult.0.expect_date">	{//如果存在预计交期则显示}
							<span>预计交期：{$detailResult.expect_date}</span>
						</notempty>
						<notempty name="detailResult.0.actual_date">	{//如果存在实际交期则显示}
							<span>实际交期：{$detailResult.actual_date}</span>
						</notempty>
					</div>
				</div>
			</div>
		</div>
		<div class="col-lg-6 sample-main-right">
			<div class="layui-collapse">
				<div class="layui-colla-item">
					<h2 class="layui-colla-title">日志</h2>
					<div class="layui-colla-content layui-colla-content-rewrite layui-show">
						<volist name="newlog" id="value">
							<eq name="i" value="1"><div>{$value.nickname}  {$value.log_time|date="Y-m-d H:i",###}  {$value.context}</div><else/><div class="sr-only">{$value.nickname}  {$value.log_time|date="Y-m-d H:i",###}  {$value.context}</div></eq>
						</volist>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="row last-row">
		<div class="col-lg-6 sample-main-left">
			<div class="layui-collapse">
				<div class="layui-colla-item">
					<h2 class="layui-colla-title">附件</h2>
					<div class="layui-colla-content layui-show">
						<volist name="attachmentResult" id="value">
	                        <div class="file-item pull-left">
	                            <div class="file-info"><i class="icon-file-alt"></i>&nbsp;&nbsp;<a href="__ROOT__{$value.path}" title="{$value.original}">{$value.original}</a></div>
	                        </div>
	                    </volist>
	                    <div class="clearfix"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-lg-6 sample-main-right">
			<div class="layui-collapse">
				<div class="layui-colla-item">
					<h2 class="layui-colla-title">备注</h2>
					<div class="layui-colla-content layui-show">
						<p>{$detailResult.note}</p>
					</div>
				</div>
			</div>
		</div>
	</div>

	{//审核按钮【当登录用户满足条件是才显示】}
	<if condition="$_SESSION['user']['id'] eq $detailResult['operating'][count($detailResult['operating'])-1]['operator']">
		<button type="button" class="btn btn-primary btn-lg solo_order" data-toggle="modal" data-target="#myModal">
			<p>添加</p>
			<p>处理记录</p>
		</button>
	</if>

</block>

<block name="modals">

	<!-------------------------------------进度条-------------------------------------------------------------------->

	<if condition="$_SESSION['user']['id'] eq $detailResult['operating'][count($detailResult['operating'])-1]['operator']">
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel" style="font-size: 18px;">订单审核</h4>
					</div>


					<form class="layui-form" action="" id="detail_form">
						<div class="modal-body">
							<div class="layui-inline" style="margin-bottom: 10px;">
								<label class="layui-form-label" style="padding-left: 0;width: 60px;">类型</label>
								<div class="layui-input-inline">
									<select class="" name="type" lay-verify="required" lay-filter="operation">
										<option value="log" selected>添加日志</option>
										<option value="push">推送</option>
										<eq name="nowStep.id" value="2">
											<option value="close" >拒绝</option>
										</eq>
									</select>
								</div>
							</div>

							<div id="operating-person" class="layui-inline sr-only" style="margin-bottom: 10px;margin-left: 20px;">
								<label class="layui-form-label" style="padding-left: 2px;width: 60px;">处理人</label>
								<div class="layui-input-inline">
									<select class="" name="state" lay-verify="required">
										<volist name="persons" id="value">
											<option value="{$value.id}">{$value.nickname}</option>
										</volist>
									</select>
								</div>
							</div>

							<div class="layui-form-item layui-form-text">
								<label class="layui-form-label" style="padding-left: 0;width: 60px;">备注</label>
								<div class="layui-input-block" style="margin-left: 60px;">
									<textarea name="context" placeholder="请输入内容" class="layui-textarea"></textarea>
								</div>
							</div>

						</div>

						<input type="hidden" name="asc_detail" value="{$detailResult.id}">

						<div class="modal-footer">
							<button type="button" class="layui-btn layui-btn-primary" data-dismiss="modal">取消</button>
							<button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
						</div>

					</form>

				</div>
			</div>
		</div>
	</if>

</block>