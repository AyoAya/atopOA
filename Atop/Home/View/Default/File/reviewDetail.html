<!-- 【模板继承】 -->
<extend name="layout/default"/>
<!-- 【引入css样式表文件】 -->
<block name="linkcss">
    <link rel="stylesheet" href="__CSS__/sample/detail.css">
    <link rel="stylesheet" href="__PUBLIC__/webuploader/css/webuploader.css">
    <link rel="stylesheet" href="__CSS__/File/reviewDetail.css">
</block>
<!-- 【引入javascript文件】 -->
<block name="linkjs">
    <script src="__PUBLIC__/webuploader/js/webuploader.js"></script>
    <script src="__JS__/File/reviewDetail.js"></script>
</block>
<!-- 【页面标题】 -->
<block name="webtitle">
    <title>评审详情</title>
</block>
<!-- 【路径导航】 -->
<block name="breadcrumb">
    <ol class="breadcrumb breadcrumb-edit">
        <li class="active"><a href="__ROOT__/File">文件管理</a></li>
        <li class="active">评审详情</li>
    </ol>
</block>

<block name="content">


    <div class="left-h4">
        <div class="title-bar">
            <h4>基本信息</h4>
        </div>

        <div class="review-info-box">
            <form class="layui-form" action="">

                <div class="layui-form-item">
                    <div class="layui-form-label ly-lab">ECN号：</div>
                    <div class="layui-input-block review-text no-update" style="color: #333;">
                        {$ecn_Data.ecn}
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-form-label ly-lab">状　态：</div>
                    <div class="layui-input-block review-text no-update">
                        <eq name="ecn_Data.status" value="1">
                            <span class="rule tag tag-primary">评审中</span>
                        </eq>
                        <eq name="ecn_Data.status" value="2">
                            <span class="rule tag tag-success">已归档</span>
                        </eq>
                        <eq name="ecn_Data.status" value="0">
                            <span class="refuse tag tag-danger">已拒绝</span>
                        </eq>
                        <eq name="ecn_Data.status" value="3">
                            <span class="refuse tag tag-danger">已撤回</span>
                        </eq>
                    </div>
                </div>

                <div class="layui-form-item" >
                    <div class="layui-form-label ly-lab">描　述：</div>
                    <div class="layui-input-block review-text" style="border: 0;margin-top: 10px;" >
                        <div class="info-div">{$ecn_Data.log}</div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-form-label ly-lab">发起人：</div>
                    <div class="layui-input-block review-text no-update" style="color: #333;">
                        {$ecn_Data.nickname}
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-form-label ly-lab">发起时间：</div>
                    <div class="layui-input-block review-text no-update" style="color: #333;">
                        {$ecn_Data.time|date="Y-m-d H:i:s",###}
                    </div>
                </div>

                <div class="layui-form-item" style="border:0;padding-left:25px;">

                </div>

            </form>

        </div>
    </div>


    <div class="title-bar" style="margin-bottom: 25px;">文件列表</div>

    <div class="pswj-rq">

            <table class="layui-table" lay-skin="line" width="100%">
                <thead>
                    <th width="150">文件号</th>
                    <th width="120">版本号</th>
                    <th width="360">附件</th>
                    <th>文件描述</th>
                </thead>
                <tbody>
                    <volist name="ecnData.number" id="value">
                        <tr>
                            <td><a href="__ROOT__/file/fileDetail/no/{$value.file_no}/version/{$value.version}">{$value.file_no}</a></td>
                            <td>{$value.version}</td>
                            <td>
                                <volist name="value.attachment" id="val">
                                    <div class="file-info"><i class="file-icon file-icon-ext-{$val.ext}"></i>&nbsp;&nbsp;<a href="__ROOT__/{$val.path}" target="_blank" title="{$val.savename}">{$val.savename}</a></div>
                                </volist>
                            </td>
                            <td>{$value.content}</td>
                        </tr>
                    </volist>
                </tbody>
            </table>

    </div>


    <div class="title-bar" style="margin: 50px 0 25px 0;">评审进度</div>

    <table class="layui-table">
        <thead>
            <tr>
                <th>评审步骤</th>
                <th>评审人</th>
                <th>评审时间</th>
                <th>状态</th>
                <th>备注信息</th>
            </tr>
        </thead>
        <tbody>
            <volist name="reviewData" id="value">
                <tr>
                    <neq name="value.step" value="0">
                        <present name="value.rowSpan">
                            <td rowspan="{$value.rowSpan}">{$value.step} 级评审</td>
                        </present>
                    <else/>
                        <td>DCC评审</td>
                    </neq>
                    <td>{$value.nickname}</td>
                    <td>
                        <notempty name="value.time">
                            {$value.time|date="Y-m-d H:i:s",###}
                        </notempty>
                    </td>
                    <td>
                        <eq name="value.status" value="1">
                            <span class="tag tag-brown">未评审</span>
                        </eq>
                        <eq name="value.status" value="2">
                            <span class="tag tag-success">已通过</span>
                        </eq>
                        <eq name="value.status" value="0">
                            <span class="tag tag-danger">已拒绝</span>
                        </eq>
                    </td>
                    <td>{$value.log}</td>
                </tr>
            </volist>
        </tbody>
    </table>

    <form action="" class="layui-form">

        <input type="hidden" value="{$Think.get.id}" name="ecn">
        <input type="hidden" value="{$ecn_Data.step}" name="step">

        <volist name="ecnData.number" id="val">
            <input type="hidden" value="{$val.id}" class="fl-num" >
        </volist>

        <eq name="ecn_Data.person" value="$Think.session.user.id">
            <eq name="ecn_Data.status" value="1">
                <button class="layui-btn" lay-submit lay-filter="rollback">撤回</button>
            </eq>
        </eq>

    </form>

</block>


{//Modal集}
<block name="modals">

    <in name="Think.session.user.id" value="$tmpNowPerson">
        <eq name="$ecn_Data.status" value="1">
            <button type="button" class="btn btn-primary btn-lg solo_order" data-toggle="modal" data-target="#Modal-box" id="log-table">
                <p>评审</p>
            </button>
        </eq>
    </in>

    <div class="modal fade" id="Modal-box" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel" style="font-size: 18px;">评审</h4>
                </div>

                <form class="layui-form" action="" id="detail_form">
                    <div class="modal-body">

                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label" style="padding-left: 0;width: 60px;">操作</label>
                            <div class="layui-input-block" style="margin-left: 60px;">
                                <select name="type" lay-verify="type">
                                    <option value="pass">通过</option>
                                    <option value="refuse">拒绝</option>
                                </select>
                            </div>
                        </div>

                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label" style="padding-left: 0;width: 60px;">日志</label>
                            <div class="layui-input-block" style="margin-left: 60px;">
                                <textarea name="context" placeholder="请输入内容" lay-verify="required" class="layui-textarea"></textarea>
                            </div>
                        </div>

                        <input type="hidden" value="{$Think.get.id}" name="rId">
                        <input type="hidden" value="{$Think.session.user.id}" name="uId">
                        <input type="hidden" value="{$nowReviewData.0.step}" name="step">

                    </div>

                    <div class="modal-footer">
                        <button type="button" class="layui-btn layui-btn-primary" data-dismiss="modal">取消</button>
                        <button class="layui-btn" lay-submit lay-filter="submit">立即提交</button>
                    </div>

                </form>

            </div>
        </div>
    </div>


</block>

