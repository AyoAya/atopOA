<!-- 【模板继承】 -->
<extend name="layout/default"/>
<!-- 【引入css样式表文件】 -->
<block name="linkcss">
    <link rel="stylesheet" href="__CSS__/approval/detail.css">
    <link rel="stylesheet" href="__CSS__/procedure.css">
    <link rel="stylesheet" href="__CSS__/block/email.css">
</block>
<!-- 【引入javascript文件】 -->
<block name="linkjs">
    <script src="__JS__/approval/detail.js"></script>
    <script src="__JS__/MyJqueryPlugin/email-block.js"></script>
</block>
<!-- 【页面标题】 -->
<block name="webtitle">
    <title>详情</title>
</block>
<!-- 【路径导航】 -->
<block name="breadcrumb">
    <ol class="breadcrumb breadcrumb-edit">
        <li><a href="__URL__/index">通用评审</a></li>
        <li class="active">详情</li>
    </ol>
</block>
<!-- 【正文区域】 -->
<block name="content">

    <div class="approval-wrapper">
        <div class="apr-title">
            <h3>{$DetailResult.title} <small><span class="tag tag-info">{$DetailResult.set.name}</span></small></h3>
        </div>
        <notempty name="DetailResult.info">
            <div class="apr-description">
                <p>
                    <kbd>描述:</kbd> {$DetailResult.info}
                </p>
            </div>
        </notempty>
        <div class="apr-info">
            <div class="apr-info-item">
                <img src="{$DetailResult.user.face}" alt="">
                <span class="apr-user">{$DetailResult.user.nickname}</span>
            </div>
            <div class="apr-info-item">
                <i class="icon-time"></i>　{$DetailResult.create_time|date="Y-m-d H:i",###}
            </div>
        </div>
    </div>

    <div class="title-bar" style="margin: 20px 0 15px 0;">
        <h4>进度</h4>
    </div>

    <div class="procedure">
        <table class="procedure-table">
            <tr class="procedure-wrap">
                <volist name="DetailResult.steps" id="value">
                    <td class="<eq name='value.state' value='completed'>active</eq> <eq name='value.state' value='refuse'>error</eq> ">
                        <div class="procedure-title" style="width: 100%;margin-left: -50%;">{$value.name}</div>
                        <div class="procedure-step">
                            <eq name="value.state" value="completed">
                                <i class="icon-ok"></i>
                            </eq>
                            <eq name="value.state" value="refuse">
                                <i class="icon-remove"></i>
                            </eq>
                            <eq name="value.state" value="">
                                <span style="font-weight: 700 !important;">{$value.step}</span>
                            </eq>
                            <eq name="value.state" value="processing">
                                <span style="font-weight: 700 !important;">{$value.step}</span>
                            </eq>
                        </div>
                        <neq name="value.state" value="processing">
                            <notempty name="value.complete_time">
                                <div class="procedure-info">
                                    {$value.operator}<br>{$value.complete_time|date="Y-m-d H:i",###}
                                </div>
                            </notempty>
                        </neq>
                        <div class="procedure-hollow"></div>
                    </td>
                </volist>
            </tr>
        </table>
    </div>

    <div class="title-bar" style="margin: 0 0 30px 0;">
        <h4>审批记录</h4>
    </div>

    <div class="context-wrapper">

        <volist name="DetailResult.log" id="value">
            <div class="context-column">
                <div class="context-item">
                    <img src="__IMG__/face/face_46.png" alt="">
                </div>

                <div class="context-item">
                    <div class="context-text">
                        <p>{$value.log}</p>
                        <p class="context-item-info">{$value.nickname}　｜　<code>Step - {$value.step} : {$value.name}</code>　| 　{$value.log_time|date='Y-m-d H:i',###}</p>
                    </div>
                </div>
            </div>

        </volist>
    </div>

    <eq name="DetailResult.state" value="Y">
        <eq name="tmpTr" value="true">
            <div class="editor-wrapper">
                <form class="layui-form">
                    <div class="layui-inline">
                        <label class="layui-form-label">动作</label>
                        <div class="layui-input-inline">
                            <select class="sel-type" name="apr_action" lay-filter="action">
                                    <eq name="nowData.0.step" value="$DetailResult.count">
                                        <option value="success">完成</option>
                                    </eq>
                                    <neq name="nowData.0.step" value="$DetailResult.count">
                                        <option value="pass">通过</option>
                                    </neq>

                                <eq name="nowData.0.refuse" value="Y">   {//如果集设定该步骤可以拒绝才显示}
                                    <option value="refuse">拒绝</option>
                                </eq>
                                <eq name="nowData.0.transfer" value="Y"> {//如果集设定该步骤可以回退才显示}
                                    <option value="transfer">转交</option>
                                </eq>
                                <gt name="DetailResult.current_step" value="1"> {//当前步骤数大于1的情况下才输出回退}
                                    <option value="rollback">回退</option>
                                </gt>
                            </select>
                        </div>

                    </div>

                    <div class="person-box layui-inline" style="margin:0;padding:0;">
                        {//推送}
                        <div class="layui-inline _person" id="pass">
                            <label class="layui-form-label" style="width: 80px;">选择人员</label>
                            <div class="layui-input-inline">
                                <select name="next_person" lay-filter="next_person">
                                    <volist name="next_data.person" id="value">
                                        <option value="{$value.id}">{$value.nickname}</option>
                                    </volist>
                                </select>
                            </div>
                        </div>

                        {//转交}
                        <div class="layui-inline sr-only" id="transfer">
                            <label class="layui-form-label">转交</label>
                            <div class="layui-input-inline">
                                <select name="transfer_user">
                                    <volist name="nowData.nickname" id="val">
                                        <option value="{$val.id}" email="{$val.email}">{$val.nickname}</option>
                                    </volist>
                                </select>
                            </div>
                        </div>

                        {//回退}
                        <div class="layui-inline sr-only" id="rollback">
                            <label class="layui-form-label">回退</label>
                            <div class="layui-input-inline">
                                <select name="rollback_user">
                                    <option value="{$fastData.id}">{$fastData.nickname}</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <include file="block:cc"/>

                    <textarea id="editor" style="display: none;"></textarea>


                    <input type="hidden" value="{$DetailResult.id}">
                    <div class="submit-box">
                        <button lay-submit class="layui-btn submit-btn" lay-filter="submit">提交</button>
                    </div>
                </form>
            </div>
        </eq>
    </eq>

</block>































